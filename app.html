<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mi Plan - GestiÃ³n del Tiempo</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * { font-family: 'Poppins', sans-serif; }
        .gradient-text { background: linear-gradient(135deg, #ec4899, #8b5cf6); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .card-hover { transition: all 0.3s ease; }
        .card-hover:hover { transform: translateY(-2px); box-shadow: 0 10px 40px rgba(0,0,0,0.1); }
        .progress-bar { transition: width 0.5s ease; }
        .tab-active { background: linear-gradient(135deg, #ec4899, #8b5cf6); color: white; }
        .checked-item { opacity: 0.6; transform: scale(0.98); }
        .habit-checked { background: linear-gradient(135deg, #fdf2f8, #f3e8ff); border-color: #c084fc; }
        .progress-ring { transition: stroke-dashoffset 0.5s ease; }
        .modal-backdrop { background: rgba(0,0,0,0.5); backdrop-filter: blur(4px); }
        .btn-icon { transition: all 0.2s; }
        .btn-icon:hover { transform: scale(1.1); }
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; border-radius: 10px; }
        ::-webkit-scrollbar-thumb { background: linear-gradient(135deg, #ec4899, #8b5cf6); border-radius: 10px; }
        .glow { box-shadow: 0 0 20px rgba(168, 85, 247, 0.4); }
        .photo-glow { box-shadow: 0 0 20px rgba(236, 72, 153, 0.4), 0 0 40px rgba(139, 92, 246, 0.3); }
    </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-rose-50 via-purple-50 to-blue-50">
    <div id="app"></div>

    <!-- Modal para Editar Actividad -->
    <div id="editModal" class="fixed inset-0 modal-backdrop z-50 hidden flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-md p-6 transform transition-all">
            <h3 class="text-xl font-bold text-gray-800 mb-4">âœï¸ Editar Actividad</h3>
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-600 mb-1">Hora</label>
                    <input type="text" id="editTime" class="w-full px-4 py-2 border border-gray-200 rounded-xl focus:ring-2 focus:ring-purple-400 focus:border-transparent outline-none" placeholder="ej: 08:30">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-600 mb-1">Actividad</label>
                    <input type="text" id="editActivity" class="w-full px-4 py-2 border border-gray-200 rounded-xl focus:ring-2 focus:ring-purple-400 focus:border-transparent outline-none" placeholder="DescripciÃ³n de la actividad">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-600 mb-1">DuraciÃ³n</label>
                    <input type="text" id="editDuration" class="w-full px-4 py-2 border border-gray-200 rounded-xl focus:ring-2 focus:ring-purple-400 focus:border-transparent outline-none" placeholder="ej: 1 hr">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-600 mb-1">CategorÃ­a</label>
                    <select id="editCategory" class="w-full px-4 py-2 border border-gray-200 rounded-xl focus:ring-2 focus:ring-purple-400 focus:border-transparent outline-none">
                        <option value="habitos">â˜€ï¸ HÃ¡bitos</option>
                        <option value="nutricion">ğŸ¥— NutriciÃ³n</option>
                        <option value="fisico">ğŸ’ª FÃ­sico</option>
                        <option value="personal">ğŸ“š Personal</option>
                        <option value="digital">ğŸ“± Digital</option>
                        <option value="espiritual">ğŸ§˜ Espiritual</option>
                        <option value="descanso">ğŸ˜´ Descanso</option>
                    </select>
                </div>
            </div>
            <div class="flex gap-3 mt-6">
                <button onclick="closeEditModal()" class="flex-1 px-4 py-2 border border-gray-200 rounded-xl text-gray-600 hover:bg-gray-50 transition">Cancelar</button>
                <button onclick="saveEdit()" class="flex-1 px-4 py-2 bg-gradient-to-r from-rose-500 to-purple-600 text-white rounded-xl hover:opacity-90 transition font-medium">Guardar</button>
            </div>
        </div>
    </div>

    <!-- Modal para Confirmar Borrado -->
    <div id="deleteModal" class="fixed inset-0 modal-backdrop z-50 hidden flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-sm p-6 transform transition-all">
            <div class="text-center">
                <span class="text-5xl">ğŸ—‘ï¸</span>
                <h3 class="text-xl font-bold text-gray-800 mt-3">Â¿Eliminar elemento?</h3>
                <p class="text-gray-500 mt-2" id="deleteActivityName">Esta acciÃ³n no se puede deshacer</p>
            </div>
            <div class="flex gap-3 mt-6">
                <button onclick="closeDeleteModal()" class="flex-1 px-4 py-2 border border-gray-200 rounded-xl text-gray-600 hover:bg-gray-50 transition">Cancelar</button>
                <button onclick="confirmDelete()" class="flex-1 px-4 py-2 bg-red-500 text-white rounded-xl hover:bg-red-600 transition font-medium">Eliminar</button>
            </div>
        </div>
    </div>

    <!-- Modal para Agregar Nueva Actividad -->
    <div id="addModal" class="fixed inset-0 modal-backdrop z-50 hidden flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-md p-6 transform transition-all">
            <h3 class="text-xl font-bold text-gray-800 mb-4">â• Nueva Actividad</h3>
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-600 mb-1">Hora</label>
                    <input type="text" id="addTime" class="w-full px-4 py-2 border border-gray-200 rounded-xl focus:ring-2 focus:ring-purple-400 focus:border-transparent outline-none" placeholder="ej: 08:30">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-600 mb-1">Actividad</label>
                    <input type="text" id="addActivity" class="w-full px-4 py-2 border border-gray-200 rounded-xl focus:ring-2 focus:ring-purple-400 focus:border-transparent outline-none" placeholder="DescripciÃ³n de la actividad">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-600 mb-1">DuraciÃ³n</label>
                    <input type="text" id="addDuration" class="w-full px-4 py-2 border border-gray-200 rounded-xl focus:ring-2 focus:ring-purple-400 focus:border-transparent outline-none" placeholder="ej: 1 hr">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-600 mb-1">CategorÃ­a</label>
                    <select id="addCategory" class="w-full px-4 py-2 border border-gray-200 rounded-xl focus:ring-2 focus:ring-purple-400 focus:border-transparent outline-none">
                        <option value="habitos">â˜€ï¸ HÃ¡bitos</option>
                        <option value="nutricion">ğŸ¥— NutriciÃ³n</option>
                        <option value="fisico">ğŸ’ª FÃ­sico</option>
                        <option value="personal">ğŸ“š Personal</option>
                        <option value="digital">ğŸ“± Digital</option>
                        <option value="espiritual">ğŸ§˜ Espiritual</option>
                        <option value="descanso">ğŸ˜´ Descanso</option>
                    </select>
                </div>
            </div>
            <div class="flex gap-3 mt-6">
                <button onclick="closeAddModal()" class="flex-1 px-4 py-2 border border-gray-200 rounded-xl text-gray-600 hover:bg-gray-50 transition">Cancelar</button>
                <button onclick="saveNewActivity()" class="flex-1 px-4 py-2 bg-gradient-to-r from-rose-500 to-purple-600 text-white rounded-xl hover:opacity-90 transition font-medium">Agregar</button>
            </div>
        </div>
    </div>

    <!-- Modal para Editar HÃ¡bito -->
    <div id="editHabitModal" class="fixed inset-0 modal-backdrop z-50 hidden flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-md p-6 transform transition-all">
            <h3 class="text-xl font-bold text-gray-800 mb-4">âœï¸ Editar HÃ¡bito</h3>
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-600 mb-1">Emoji</label>
                    <input type="text" id="editHabitIcon" class="w-full px-4 py-2 border border-gray-200 rounded-xl focus:ring-2 focus:ring-purple-400 focus:border-transparent outline-none" placeholder="ej: â˜€ï¸">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-600 mb-1">Nombre del hÃ¡bito</label>
                    <input type="text" id="editHabitName" class="w-full px-4 py-2 border border-gray-200 rounded-xl focus:ring-2 focus:ring-purple-400 focus:border-transparent outline-none" placeholder="ej: Despertar 7:00 AM">
                </div>
            </div>
            <div class="flex gap-3 mt-6">
                <button onclick="closeEditHabitModal()" class="flex-1 px-4 py-2 border border-gray-200 rounded-xl text-gray-600 hover:bg-gray-50 transition">Cancelar</button>
                <button onclick="saveHabitEdit()" class="flex-1 px-4 py-2 bg-gradient-to-r from-rose-500 to-purple-600 text-white rounded-xl hover:opacity-90 transition font-medium">Guardar</button>
            </div>
        </div>
    </div>

    <!-- Modal para Agregar HÃ¡bito -->
    <div id="addHabitModal" class="fixed inset-0 modal-backdrop z-50 hidden flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-md p-6 transform transition-all">
            <h3 class="text-xl font-bold text-gray-800 mb-4">â• Nuevo HÃ¡bito</h3>
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-600 mb-1">Emoji</label>
                    <input type="text" id="addHabitIcon" class="w-full px-4 py-2 border border-gray-200 rounded-xl focus:ring-2 focus:ring-purple-400 focus:border-transparent outline-none" placeholder="ej: â˜€ï¸">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-600 mb-1">Nombre del hÃ¡bito</label>
                    <input type="text" id="addHabitName" class="w-full px-4 py-2 border border-gray-200 rounded-xl focus:ring-2 focus:ring-purple-400 focus:border-transparent outline-none" placeholder="ej: Despertar 7:00 AM">
                </div>
            </div>
            <div class="flex gap-3 mt-6">
                <button onclick="closeAddHabitModal()" class="flex-1 px-4 py-2 border border-gray-200 rounded-xl text-gray-600 hover:bg-gray-50 transition">Cancelar</button>
                <button onclick="saveNewHabit()" class="flex-1 px-4 py-2 bg-gradient-to-r from-rose-500 to-purple-600 text-white rounded-xl hover:opacity-90 transition font-medium">Agregar</button>
            </div>
        </div>
    </div>

    <!-- Modal para Editar Ejercicio Gym -->
    <div id="editGymModal" class="fixed inset-0 modal-backdrop z-50 hidden flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-md p-6 transform transition-all">
            <h3 class="text-xl font-bold text-gray-800 mb-4">âœï¸ Editar Ejercicio</h3>
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-600 mb-1">Ejercicio</label>
                    <input type="text" id="editGymExercise" class="w-full px-4 py-2 border border-gray-200 rounded-xl focus:ring-2 focus:ring-purple-400 focus:border-transparent outline-none" placeholder="ej: Hip Thrust con barra 4x12">
                </div>
            </div>
            <div class="flex gap-3 mt-6">
                <button onclick="closeEditGymModal()" class="flex-1 px-4 py-2 border border-gray-200 rounded-xl text-gray-600 hover:bg-gray-50 transition">Cancelar</button>
                <button onclick="saveGymEdit()" class="flex-1 px-4 py-2 bg-gradient-to-r from-rose-500 to-purple-600 text-white rounded-xl hover:opacity-90 transition font-medium">Guardar</button>
            </div>
        </div>
    </div>

    <!-- Modal para Agregar Ejercicio Gym -->
    <div id="addGymModal" class="fixed inset-0 modal-backdrop z-50 hidden flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-md p-6 transform transition-all">
            <h3 class="text-xl font-bold text-gray-800 mb-4">â• Nuevo Ejercicio</h3>
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-600 mb-1">Ejercicio</label>
                    <input type="text" id="addGymExercise" class="w-full px-4 py-2 border border-gray-200 rounded-xl focus:ring-2 focus:ring-purple-400 focus:border-transparent outline-none" placeholder="ej: Hip Thrust con barra 4x12">
                </div>
            </div>
            <div class="flex gap-3 mt-6">
                <button onclick="closeAddGymModal()" class="flex-1 px-4 py-2 border border-gray-200 rounded-xl text-gray-600 hover:bg-gray-50 transition">Cancelar</button>
                <button onclick="saveNewGymExercise()" class="flex-1 px-4 py-2 bg-gradient-to-r from-rose-500 to-purple-600 text-white rounded-xl hover:opacity-90 transition font-medium">Agregar</button>
            </div>
        </div>
    </div>

    <!-- Modal para Editar Comida -->
    <div id="editMealModal" class="fixed inset-0 modal-backdrop z-50 hidden flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-md p-6 transform transition-all max-h-[90vh] overflow-y-auto">
            <h3 class="text-xl font-bold text-gray-800 mb-4">âœï¸ Editar Comida</h3>
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-600 mb-1">Hora</label>
                    <input type="text" id="editMealTime" class="w-full px-4 py-2 border border-gray-200 rounded-xl focus:ring-2 focus:ring-purple-400 focus:border-transparent outline-none" placeholder="ej: 07:45">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-600 mb-1">Nombre</label>
                    <input type="text" id="editMealName" class="w-full px-4 py-2 border border-gray-200 rounded-xl focus:ring-2 focus:ring-purple-400 focus:border-transparent outline-none" placeholder="ej: Desayuno">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-600 mb-1">Emoji</label>
                    <input type="text" id="editMealEmoji" class="w-full px-4 py-2 border border-gray-200 rounded-xl focus:ring-2 focus:ring-purple-400 focus:border-transparent outline-none" placeholder="ej: ğŸŒ…">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-600 mb-1">Opciones (una por lÃ­nea)</label>
                    <textarea id="editMealOptions" rows="4" class="w-full px-4 py-2 border border-gray-200 rounded-xl focus:ring-2 focus:ring-purple-400 focus:border-transparent outline-none" placeholder="OpciÃ³n 1&#10;OpciÃ³n 2&#10;OpciÃ³n 3"></textarea>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-600 mb-1">Macros</label>
                    <input type="text" id="editMealMacros" class="w-full px-4 py-2 border border-gray-200 rounded-xl focus:ring-2 focus:ring-purple-400 focus:border-transparent outline-none" placeholder="ej: P:30g | C:45g | G:15g">
                </div>
            </div>
            <div class="flex gap-3 mt-6">
                <button onclick="closeEditMealModal()" class="flex-1 px-4 py-2 border border-gray-200 rounded-xl text-gray-600 hover:bg-gray-50 transition">Cancelar</button>
                <button onclick="saveMealEdit()" class="flex-1 px-4 py-2 bg-gradient-to-r from-rose-500 to-purple-600 text-white rounded-xl hover:opacity-90 transition font-medium">Guardar</button>
            </div>
        </div>
    </div>

    <!-- Modal para Agregar Comida -->
    <div id="addMealModal" class="fixed inset-0 modal-backdrop z-50 hidden flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-md p-6 transform transition-all max-h-[90vh] overflow-y-auto">
            <h3 class="text-xl font-bold text-gray-800 mb-4">â• Nueva Comida</h3>
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-600 mb-1">Hora</label>
                    <input type="text" id="addMealTime" class="w-full px-4 py-2 border border-gray-200 rounded-xl focus:ring-2 focus:ring-purple-400 focus:border-transparent outline-none" placeholder="ej: 07:45">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-600 mb-1">Nombre</label>
                    <input type="text" id="addMealName" class="w-full px-4 py-2 border border-gray-200 rounded-xl focus:ring-2 focus:ring-purple-400 focus:border-transparent outline-none" placeholder="ej: Desayuno">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-600 mb-1">Emoji</label>
                    <input type="text" id="addMealEmoji" class="w-full px-4 py-2 border border-gray-200 rounded-xl focus:ring-2 focus:ring-purple-400 focus:border-transparent outline-none" placeholder="ej: ğŸŒ…">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-600 mb-1">Opciones (una por lÃ­nea)</label>
                    <textarea id="addMealOptions" rows="4" class="w-full px-4 py-2 border border-gray-200 rounded-xl focus:ring-2 focus:ring-purple-400 focus:border-transparent outline-none" placeholder="OpciÃ³n 1&#10;OpciÃ³n 2&#10;OpciÃ³n 3"></textarea>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-600 mb-1">Macros</label>
                    <input type="text" id="addMealMacros" class="w-full px-4 py-2 border border-gray-200 rounded-xl focus:ring-2 focus:ring-purple-400 focus:border-transparent outline-none" placeholder="ej: P:30g | C:45g | G:15g">
                </div>
            </div>
            <div class="flex gap-3 mt-6">
                <button onclick="closeAddMealModal()" class="flex-1 px-4 py-2 border border-gray-200 rounded-xl text-gray-600 hover:bg-gray-50 transition">Cancelar</button>
                <button onclick="saveNewMeal()" class="flex-1 px-4 py-2 bg-gradient-to-r from-rose-500 to-purple-600 text-white rounded-xl hover:opacity-90 transition font-medium">Agregar</button>
            </div>
        </div>
    </div>

    <!-- Modal para Editar Meta Semanal -->
    <div id="editGoalModal" class="fixed inset-0 modal-backdrop z-50 hidden flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-md p-6 transform transition-all max-h-[90vh] overflow-y-auto">
            <h3 class="text-xl font-bold text-gray-800 mb-4">âœï¸ Editar Meta Semanal</h3>
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-600 mb-1">Semana</label>
                    <input type="number" id="editGoalWeek" min="1" max="12" class="w-full px-4 py-2 border border-gray-200 rounded-xl focus:ring-2 focus:ring-purple-400 focus:border-transparent outline-none" placeholder="ej: 1">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-600 mb-1">Fechas</label>
                    <input type="text" id="editGoalDates" class="w-full px-4 py-2 border border-gray-200 rounded-xl focus:ring-2 focus:ring-purple-400 focus:border-transparent outline-none" placeholder="ej: 2-8 Feb">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-600 mb-1">ğŸ’ª Meta FÃ­sica</label>
                    <input type="text" id="editGoalFisica" class="w-full px-4 py-2 border border-gray-200 rounded-xl focus:ring-2 focus:ring-purple-400 focus:border-transparent outline-none">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-600 mb-1">ğŸ“š Meta Personal</label>
                    <input type="text" id="editGoalPersonal" class="w-full px-4 py-2 border border-gray-200 rounded-xl focus:ring-2 focus:ring-purple-400 focus:border-transparent outline-none">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-600 mb-1">ğŸ“± Meta Digital</label>
                    <input type="text" id="editGoalDigital" class="w-full px-4 py-2 border border-gray-200 rounded-xl focus:ring-2 focus:ring-purple-400 focus:border-transparent outline-none">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-600 mb-1">ğŸ§˜ Meta Espiritual</label>
                    <input type="text" id="editGoalEspiritual" class="w-full px-4 py-2 border border-gray-200 rounded-xl focus:ring-2 focus:ring-purple-400 focus:border-transparent outline-none">
                </div>
            </div>
            <div class="flex gap-3 mt-6">
                <button onclick="closeEditGoalModal()" class="flex-1 px-4 py-2 border border-gray-200 rounded-xl text-gray-600 hover:bg-gray-50 transition">Cancelar</button>
                <button onclick="saveGoalEdit()" class="flex-1 px-4 py-2 bg-gradient-to-r from-rose-500 to-purple-600 text-white rounded-xl hover:opacity-90 transition font-medium">Guardar</button>
            </div>
        </div>
    </div>

    <!-- Modal para Reemplazar Todos -->
    <div id="replaceAllModal" class="fixed inset-0 modal-backdrop z-50 hidden flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-sm p-6 transform transition-all">
            <h3 class="text-xl font-bold text-gray-800 mb-2 text-center">ğŸ”„ Â¿Aplicar a todos?</h3>
            <p id="replaceAllMessage" class="text-gray-600 text-center mb-6">Â¿Quieres aplicar este cambio a todos los dÃ­as?</p>

            <div class="space-y-3">
                <button onclick="confirmReplaceAll(true)" class="w-full py-3 bg-gradient-to-r from-purple-500 to-pink-500 text-white rounded-xl font-medium hover:opacity-90 transition">
                    âœ… SÃ­, aplicar a todos
                </button>
                <button onclick="confirmReplaceAll(false)" class="w-full py-3 border-2 border-gray-200 text-gray-700 rounded-xl font-medium hover:bg-gray-50 transition">
                    ğŸ“… Solo este dÃ­a
                </button>
                <button onclick="closeReplaceAllModal()" class="w-full py-2 text-gray-400 hover:text-gray-600 transition text-sm">
                    Cancelar
                </button>
            </div>
        </div>
    </div>

    <!-- Modal para Foto de Perfil -->
    <div id="photoModal" class="fixed inset-0 modal-backdrop z-50 hidden flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-sm p-6 transform transition-all">
            <h3 class="text-xl font-bold text-gray-800 mb-4 text-center">ğŸ“¸ Foto de Perfil</h3>

            <!-- Preview actual -->
            <div class="flex justify-center mb-6">
                <div id="photoPreview" class="w-32 h-32 rounded-full bg-gradient-to-r from-pink-500 to-purple-500 flex items-center justify-center text-white text-4xl font-bold border-4 border-purple-200 overflow-hidden">
                    <!-- Se llena dinÃ¡micamente -->
                </div>
            </div>

            <!-- Opciones -->
            <div class="space-y-3">
                <label class="flex items-center justify-center gap-3 w-full py-3 bg-gradient-to-r from-purple-500 to-pink-500 text-white rounded-xl font-medium cursor-pointer hover:opacity-90 transition">
                    <span>ğŸ“ Subir foto</span>
                    <input type="file" id="photoInput" accept="image/*" class="hidden" onchange="handlePhotoUpload(event)">
                </label>

                <label class="flex items-center justify-center gap-3 w-full py-3 bg-gradient-to-r from-blue-500 to-cyan-500 text-white rounded-xl font-medium cursor-pointer hover:opacity-90 transition">
                    <span>ğŸ“· Tomar foto</span>
                    <input type="file" id="cameraInput" accept="image/*" capture="user" class="hidden" onchange="handlePhotoUpload(event)">
                </label>

                <button onclick="removePhoto()" id="removePhotoBtn" class="w-full py-3 border-2 border-red-200 text-red-500 rounded-xl font-medium hover:bg-red-50 transition hidden">
                    ğŸ—‘ï¸ Eliminar foto
                </button>
            </div>

            <button onclick="closePhotoModal()" class="w-full mt-4 py-2 text-gray-500 hover:text-gray-700 transition">
                Cerrar
            </button>
        </div>
    </div>

    <script>
        // Check login
        const currentUser = JSON.parse(localStorage.getItem('gestion-currentUser'));
        if (!currentUser) {
            window.location.href = 'login.html';
        }

        // Check if user needs onboarding (and hasn't completed it)
        if (currentUser && currentUser.needsOnboarding && !currentUser.onboardingCompleted) {
            window.location.href = 'onboarding.html';
        }

        // User-specific storage key prefix
        const userKey = currentUser ? currentUser.email.replace(/[^a-z0-9]/gi, '_') : 'guest';

        function getStorage(key) {
            return localStorage.getItem(`${userKey}-${key}`);
        }

        function setStorage(key, value) {
            localStorage.setItem(`${userKey}-${key}`, value);
        }

        function removeStorage(key) {
            localStorage.removeItem(`${userKey}-${key}`);
        }

        function logout() {
            if (confirm('Â¿Seguro que quieres cerrar sesiÃ³n?')) {
                localStorage.removeItem('gestion-currentUser');
                window.location.href = 'login.html';
            }
        }

        // Profile Photo Functions
        function openPhotoModal() {
            const modal = document.getElementById('photoModal');
            const preview = document.getElementById('photoPreview');
            const removeBtn = document.getElementById('removePhotoBtn');
            const photo = getStorage('profile-photo');

            if (photo) {
                preview.innerHTML = `<img src="${photo}" class="w-full h-full object-cover">`;
                removeBtn.classList.remove('hidden');
            } else {
                preview.innerHTML = currentUser.name.charAt(0).toUpperCase();
                removeBtn.classList.add('hidden');
            }

            modal.classList.remove('hidden');
        }

        function closePhotoModal() {
            document.getElementById('photoModal').classList.add('hidden');
        }

        // Comprimir imagen con mÃºltiples pasadas hasta alcanzar el tamaÃ±o objetivo
        function compressImage(img, maxSize, maxKB) {
            const canvas = document.createElement('canvas');
            canvas.width = maxSize;
            canvas.height = maxSize;
            const ctx = canvas.getContext('2d');

            // Recortar al centro (cuadrado)
            const minDim = Math.min(img.width, img.height);
            const sx = (img.width - minDim) / 2;
            const sy = (img.height - minDim) / 2;

            ctx.drawImage(img, sx, sy, minDim, minDim, 0, 0, maxSize, maxSize);

            // Comprimir iterativamente hasta alcanzar el tamaÃ±o objetivo
            let quality = 0.7;
            let photoData = canvas.toDataURL('image/jpeg', quality);
            let sizeKB = (photoData.length * 3/4) / 1024;

            // Reducir calidad si es necesario
            while (sizeKB > maxKB && quality > 0.1) {
                quality -= 0.1;
                photoData = canvas.toDataURL('image/jpeg', quality);
                sizeKB = (photoData.length * 3/4) / 1024;
            }

            // Si aÃºn es muy grande, reducir tamaÃ±o del canvas
            if (sizeKB > maxKB) {
                const smallerSize = Math.floor(maxSize * 0.7);
                canvas.width = smallerSize;
                canvas.height = smallerSize;
                ctx.drawImage(img, sx, sy, minDim, minDim, 0, 0, smallerSize, smallerSize);
                photoData = canvas.toDataURL('image/jpeg', 0.5);
            }

            return photoData;
        }

        function handlePhotoUpload(event) {
            const file = event.target.files[0];
            if (!file) return;

            // Validar tamaÃ±o (max 5MB original)
            if (file.size > 5 * 1024 * 1024) {
                alert('La imagen es muy grande. MÃ¡ximo 5MB.');
                return;
            }

            // Mostrar loading
            document.getElementById('photoPreview').innerHTML = '<span class="text-2xl animate-pulse">â³</span>';

            const reader = new FileReader();
            reader.onload = function(e) {
                const img = new Image();
                img.onload = function() {
                    // Comprimir imagen
                    const photoData = compressImage(img, 150, 30); // 150px, max 30KB

                    // Mostrar tamaÃ±o final
                    const sizeKB = Math.round((photoData.length * 3/4) / 1024);
                    console.log(`Foto comprimida: ${sizeKB}KB`);

                    setStorage('profile-photo', photoData);

                    // Actualizar preview
                    document.getElementById('photoPreview').innerHTML = `<img src="${photoData}" class="w-full h-full object-cover">`;
                    document.getElementById('removePhotoBtn').classList.remove('hidden');

                    // Actualizar header
                    render();
                };
                img.src = e.target.result;
            };
            reader.readAsDataURL(file);
        }

        function removePhoto() {
            if (confirm('Â¿Eliminar foto de perfil?')) {
                removeStorage('profile-photo');
                document.getElementById('photoPreview').innerHTML = currentUser.name.charAt(0).toUpperCase();
                document.getElementById('removePhotoBtn').classList.add('hidden');
                render();
            }
        }

        function getUserPhoto() {
            return getStorage('profile-photo');
        }

        // Replace All Modal Functions
        let pendingReplaceAll = null; // { type, oldValue, newValue, callback }

        function showReplaceAllModal(type, message, callback) {
            pendingReplaceAll = { type, callback };
            document.getElementById('replaceAllMessage').textContent = message;
            document.getElementById('replaceAllModal').classList.remove('hidden');
        }

        function closeReplaceAllModal() {
            document.getElementById('replaceAllModal').classList.add('hidden');
            pendingReplaceAll = null;
        }

        function confirmReplaceAll(replaceAll) {
            if (pendingReplaceAll && pendingReplaceAll.callback) {
                pendingReplaceAll.callback(replaceAll);
            }
            closeReplaceAllModal();
            render();
        }

        // Goal text mapping
        function getGoalText(goal) {
            const goals = {
                fitness: 'ğŸ’ª Mejorando mi fÃ­sico',
                productivity: 'ğŸ“ˆ Siendo mÃ¡s productivo',
                learning: 'ğŸ“š Aprendiendo algo nuevo',
                health: 'ğŸ¥— Mejorando mi salud',
                business: 'ğŸ’¼ Haciendo crecer mi negocio',
                competition: 'ğŸ‘‘ PreparÃ¡ndome para competir',
                personal: 'âœ¨ Desarrollo personal',
                other: 'ğŸ¯ Alcanzando mis metas'
            };
            return goals[goal] || goals.other;
        }

        // Data - User specific dates based on their plan
        const userStartDate = currentUser ? new Date(currentUser.startDate) : new Date();
        const userDuration = currentUser ? currentUser.duration : 60;
        const totalWeeks = Math.ceil(userDuration / 7);
        const startDate = new Date(userStartDate);
        const endDate = new Date(userStartDate);
        endDate.setDate(endDate.getDate() + userDuration - 1);

        let currentDate = new Date();
        // Clamp current date to plan range
        if (currentDate < startDate) currentDate = new Date(startDate);
        if (currentDate > endDate) currentDate = new Date(endDate);

        let activeTab = 'agenda';
        let checkedHabits = JSON.parse(getStorage('habits') || '{}');
        let completedActivities = JSON.parse(getStorage('activities') || '{}');
        let customSchedules = JSON.parse(getStorage('custom-schedules') || '{}');
        let customHabits = JSON.parse(getStorage('custom-habits') || 'null');
        let customGym = JSON.parse(getStorage('custom-gym') || '{}');
        let customMeals = JSON.parse(getStorage('custom-meals') || 'null');
        let customGoals = JSON.parse(getStorage('custom-goals') || 'null');

        let editingIndex = null;
        let deletingIndex = null;
        let deleteType = 'activity';

        const daysSpanish = ['Domingo', 'Lunes', 'Martes', 'MiÃ©rcoles', 'Jueves', 'Viernes', 'SÃ¡bado'];
        const monthsSpanish = ['Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio', 'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'];

        const defaultGymFocus = {
            0: { name: "Descanso Activo", icon: "ğŸ§˜", exercises: ["Yoga suave 30-45min", "Estiramientos profundos 20min", "Caminata ligera opcional", "MeditaciÃ³n con movimiento 15min"] },
            1: { name: "GlÃºteos + CuÃ¡driceps", icon: "ğŸ‘", exercises: ["Hip Thrust con barra 4x12", "Sentadilla profunda 4x10", "Prensa inclinada 4x12", "Zancadas caminando 3x12", "ExtensiÃ³n cuÃ¡driceps 3x15", "Abductores mÃ¡quina 3x20"] },
            2: { name: "Isquios + GlÃºteos", icon: "ğŸ¦µ", exercises: ["Peso muerto rumano 4x10", "Curl femoral acostada 4x12", "Patada glÃºteo polea 3x15", "Puente glÃºteos elevado 4x15", "Good mornings 3x12", "Hip abduction 3x20"] },
            3: { name: "Tren Superior + Core", icon: "ğŸ’ª", exercises: ["Press pecho mancuernas 3x12", "Remo mancuerna 3x12", "Press hombro 3x12", "Curl bÃ­ceps 3x15", "TrÃ­ceps polea 3x15", "Plancha 3x30seg + Crunches 3x20"] },
            4: { name: "Piernas + HIIT", icon: "ğŸ”¥", exercises: ["Sentadilla bÃºlgara 4x10", "Leg press pies juntos 4x12", "Step ups con peso 3x12", "Curl femoral sentada 3x15", "HIIT: Burpees, Jumping jacks 4 rondas"] },
            5: { name: "GlÃºteos (Ã©nfasis) + Brazos", icon: "âœ¨", exercises: ["Hip thrust unilateral 4x12", "Sumo squat mancuerna 4x15", "Kickbacks polea 3x15", "Frog pumps 3x25", "Curl martillo 3x12", "Fondos trÃ­ceps 3x12"] },
            6: { name: "Baile + Stretching", icon: "ğŸ’ƒ", exercises: ["Clase baile/gimnasia 60-90min", "Estiramiento dinÃ¡mico 15min", "Foam roller piernas 15min", "Yoga flow 20min"] }
        };

        function getGymFocus(dayIndex) {
            if (customGym[dayIndex]) {
                return customGym[dayIndex];
            }
            return defaultGymFocus[dayIndex];
        }

        const defaultHabits = [
            { id: 1, name: "Despertar 7:00 AM", icon: "â˜€ï¸" },
            { id: 2, name: "Agua al despertar (500ml)", icon: "ğŸ’§" },
            { id: 3, name: "Suplementos tomados", icon: "ğŸ’Š" },
            { id: 4, name: "MeditaciÃ³n 30 min", icon: "ğŸ§˜" },
            { id: 5, name: "Afirmaciones positivas", icon: "âœ¨" },
            { id: 6, name: "Desayuno proteico", icon: "ğŸ¥—" },
            { id: 7, name: "Clase de inglÃ©s", icon: "ğŸ‡¬ğŸ‡§" },
            { id: 8, name: "Skincare AM", icon: "ğŸ§´" },
            { id: 9, name: "Entrenamiento completado", icon: "ğŸ’ª" },
            { id: 10, name: "Post-entreno proteico", icon: "ğŸ¥¤" },
            { id: 11, name: "Contenido RRSS creado", icon: "ğŸ“¸" },
            { id: 12, name: "Publicado en RRSS", icon: "ğŸ“±" },
            { id: 13, name: "InteracciÃ³n audiencia", icon: "ğŸ’¬" },
            { id: 14, name: "Cena sin azÃºcar", icon: "ğŸ¥¦" },
            { id: 15, name: "Skincare PM + celulitis", icon: "ğŸŒ™" },
            { id: 16, name: "Gratitud (3 cosas)", icon: "ğŸ™" },
            { id: 17, name: "En cama 22:00", icon: "ğŸ˜´" },
            { id: 18, name: "3L agua bebidos", icon: "ğŸ’¦" }
        ];

        function getHabits() {
            return customHabits || defaultHabits;
        }

        const defaultMeals = [
            { time: "07:45", name: "Desayuno", emoji: "ğŸŒ…", options: ["Avena + proteÃ­na + frutos rojos", "Huevos revueltos + verduras + tostada integral", "Smoothie bowl proteico con semillas"], macros: "P:30g | C:45g | G:15g" },
            { time: "10:30", name: "Snack AM", emoji: "ğŸ", options: ["Yogurt griego + nueces", "Fruta + almendras", "Batido verde proteico"], macros: "P:15g | C:20g | G:10g" },
            { time: "12:00", name: "Almuerzo", emoji: "ğŸ¥—", options: ["ProteÃ­na 150g (pollo/pescado/pavo)", "Carbohidrato complejo 1 taza", "Vegetales variados ilimitados", "Grasa saludable (aguacate)"], macros: "P:40g | C:50g | G:15g" },
            { time: "16:00", name: "Post-Entreno", emoji: "ğŸ’ª", options: ["ProteÃ­na whey + banana + leche vegetal", "Yogurt griego + granola sin azÃºcar"], macros: "P:30g | C:30g | G:5g" },
            { time: "20:00", name: "Cena", emoji: "ğŸŒ™", options: ["ProteÃ­na magra 120g", "Vegetales al vapor o ensalada grande", "Sin carbohidratos pesados"], macros: "P:35g | C:20g | G:12g" }
        ];

        function getMeals() {
            return customMeals || defaultMeals;
        }

        const defaultWeeklyGoals = [
            { week: 1, dates: "2-8 Feb", fisica: "Establecer rutina gym. Medir peso inicial", personal: "Inicio inglÃ©s intensivo + pasarela", digital: "Crear web bÃ¡sica", espiritual: "Establecer meditaciÃ³n diaria" },
            { week: 2, dates: "9-15 Feb", fisica: "Ajustar plan nutricional. -0.5kg grasa", personal: "Mejorar pronunciaciÃ³n inglÃ©s", digital: "5 posts. Contactar marcas", espiritual: "Journaling diario" },
            { week: 3, dates: "16-22 Feb", fisica: "Incrementar peso en glÃºteos", personal: "Conversaciones bÃ¡sicas inglÃ©s", digital: "12K seguidores. Portafolio", espiritual: "Bajar autoexigencia" },
            { week: 4, dates: "23 Feb-1 Mar", fisica: "DefiniciÃ³n visible piernas", personal: "PresentaciÃ³n en inglÃ©s", digital: "15K. Primera colaboraciÃ³n", espiritual: "Sin episodios nerviosismo" },
            { week: 5, dates: "2-8 Mar", fisica: "Abdominales marcados", personal: "Fluidez conversacional", digital: "Blog semanal. 5%+ engagement", espiritual: "Manejo emocional estable" },
            { week: 6, dates: "9-15 Mar", fisica: "GlÃºteos definidos. Verificar 58kg", personal: "Speech en inglÃ©s listo", digital: "17K. Contenido viral", espiritual: "Autoconfianza alta" },
            { week: 7, dates: "16-22 Mar", fisica: "Cuerpo Ã³ptimo. Piel radiante", personal: "InglÃ©s intermedio-alto", digital: "19K. Portafolio completo", espiritual: "Nervios controlados" },
            { week: 8, dates: "23-30 Mar", fisica: "ğŸ¯ 58kg, definiciÃ³n total", personal: "ğŸ¯ InglÃ©s fluido, pasarela 100%", digital: "ğŸ¯ 20K+, marca sÃ³lida", espiritual: "ğŸ¯ Confianza total" }
        ];

        function getWeeklyGoals() {
            return customGoals || defaultWeeklyGoals;
        }

        const categoryColors = {
            habitos: { bg: "bg-amber-50", border: "border-amber-200", text: "text-amber-700", badge: "bg-amber-100" },
            nutricion: { bg: "bg-green-50", border: "border-green-200", text: "text-green-700", badge: "bg-green-100" },
            fisico: { bg: "bg-rose-50", border: "border-rose-200", text: "text-rose-700", badge: "bg-rose-100" },
            personal: { bg: "bg-blue-50", border: "border-blue-200", text: "text-blue-700", badge: "bg-blue-100" },
            digital: { bg: "bg-purple-50", border: "border-purple-200", text: "text-purple-700", badge: "bg-purple-100" },
            espiritual: { bg: "bg-indigo-50", border: "border-indigo-200", text: "text-indigo-700", badge: "bg-indigo-100" },
            descanso: { bg: "bg-slate-50", border: "border-slate-200", text: "text-slate-700", badge: "bg-slate-100" }
        };

        function getDefaultSchedule(dayIndex) {
            if (dayIndex === 0) return getSundaySchedule();
            if (dayIndex === 6) return getSaturdaySchedule();
            return getWeekdaySchedule(dayIndex);
        }

        function getSchedule(dayIndex, dateKey) {
            if (customSchedules[dateKey]) {
                return customSchedules[dateKey];
            }
            return getDefaultSchedule(dayIndex);
        }

        function saveCustomSchedule(dateKey, schedule) {
            customSchedules[dateKey] = schedule;
            setStorage('custom-schedules', JSON.stringify(customSchedules));
        }

        function getWeekdaySchedule(dayIndex) {
            const gym = getGymFocus(dayIndex);
            const schedule = [
                { time: "06:45", activity: "Despertar + Agua tibia con limÃ³n ğŸ‹", duration: "15 min", category: "habitos" },
                { time: "07:00", activity: "Suplementos: Creatina + Omega 3 + Vitamina C", duration: "15 min", category: "nutricion" },
                { time: "07:15", activity: "MeditaciÃ³n guiada + Afirmaciones âœ¨", duration: "30 min", category: "espiritual" },
                { time: "07:45", activity: "Desayuno proteico", duration: "45 min", category: "nutricion" },
                { time: "08:30", activity: "Clase de InglÃ©s Intensivo ğŸ‡¬ğŸ‡§", duration: "2 hrs", category: "personal" },
                { time: "10:30", activity: "Snack saludable + HidrataciÃ³n", duration: "30 min", category: "nutricion" },
                { time: "11:00", activity: "Skincare facial + Cuidado capilar ğŸ’†â€â™€ï¸", duration: "1 hr", category: "fisico" },
                { time: "12:00", activity: "Almuerzo balanceado", duration: "1 hr", category: "nutricion" },
                { time: "13:00", activity: "Descanso / Lectura / Journaling ğŸ“–", duration: "1 hr", category: "espiritual" },
                { time: "14:00", activity: `Gimnasio: ${gym.name} ${gym.icon}`, duration: "2 hrs", category: "fisico" },
                { time: "16:00", activity: "Batido proteico post-entreno ğŸ¥¤", duration: "30 min", category: "nutricion" }
            ];

            if ([1, 3, 5].includes(dayIndex)) {
                schedule.push({ time: "16:30", activity: "Clase de Pasarela (estilo Sheynnis Palacios) ğŸ‘ ", duration: "1.5 hrs", category: "personal" });
            } else {
                schedule.push({ time: "16:30", activity: "Coaching Oratoria con Coni ğŸ¤", duration: "1.5 hrs", category: "personal" });
            }

            schedule.push(
                { time: "18:00", activity: "CreaciÃ³n contenido RRSS ğŸ“¸", duration: "1 hr", category: "digital" },
                { time: "19:00", activity: "Publicar + Interactuar audiencia ğŸ“±", duration: "30 min", category: "digital" },
                { time: "19:30", activity: "Revisar mÃ©tricas + Planificar ğŸ“Š", duration: "30 min", category: "digital" },
                { time: "20:00", activity: "Cena saludable", duration: "1 hr", category: "nutricion" },
                { time: "21:00", activity: "Skincare nocturno + Tratamiento celulitis ğŸŒ™", duration: "30 min", category: "fisico" },
                { time: "21:30", activity: "Gratitud + Preparar maÃ±ana ğŸ™", duration: "30 min", category: "espiritual" },
                { time: "22:00", activity: "DORMIR ğŸ˜´ (9 horas)", duration: "9 hrs", category: "descanso" }
            );

            return schedule;
        }

        function getSaturdaySchedule() {
            return [
                { time: "07:00", activity: "Despertar + HidrataciÃ³n ğŸ’§", duration: "15 min", category: "habitos" },
                { time: "07:15", activity: "Suplementos matutinos", duration: "15 min", category: "nutricion" },
                { time: "07:30", activity: "MeditaciÃ³n + Afirmaciones âœ¨", duration: "30 min", category: "espiritual" },
                { time: "08:00", activity: "Desayuno proteico", duration: "1 hr", category: "nutricion" },
                { time: "09:00", activity: "Clase de Baile / Gimnasia ğŸ’ƒ", duration: "1.5 hrs", category: "personal" },
                { time: "10:30", activity: "Snack + HidrataciÃ³n", duration: "30 min", category: "nutricion" },
                { time: "11:00", activity: "SesiÃ³n fotos / Contenido semanal ğŸ“¸", duration: "2 hrs", category: "digital" },
                { time: "13:00", activity: "Almuerzo", duration: "1 hr", category: "nutricion" },
                { time: "14:00", activity: "Descanso / Autocuidado ğŸ’†â€â™€ï¸", duration: "1 hr", category: "espiritual" },
                { time: "15:00", activity: "Trabajo en PÃ¡gina Web / Portafolio ğŸ’»", duration: "2 hrs", category: "digital" },
                { time: "17:00", activity: "Cardio suave + Stretching ğŸ§˜", duration: "1 hr", category: "fisico" },
                { time: "18:00", activity: "Programar contenido semanal", duration: "1 hr", category: "digital" },
                { time: "19:00", activity: "Tiempo libre / Social ğŸ‘¯â€â™€ï¸", duration: "1 hr", category: "personal" },
                { time: "20:00", activity: "Cena", duration: "1 hr", category: "nutricion" },
                { time: "21:00", activity: "Rutina nocturna + PlanificaciÃ³n ğŸŒ™", duration: "1 hr", category: "espiritual" },
                { time: "22:00", activity: "DORMIR ğŸ˜´", duration: "9 hrs", category: "descanso" }
            ];
        }

        function getSundaySchedule() {
            return [
                { time: "08:00", activity: "Despertar natural + HidrataciÃ³n â˜€ï¸", duration: "15 min", category: "habitos" },
                { time: "08:15", activity: "Omega 3 + Vitamina C (descanso creatina)", duration: "15 min", category: "nutricion" },
                { time: "08:30", activity: "MeditaciÃ³n extendida + VisualizaciÃ³n ğŸ§˜", duration: "1 hr", category: "espiritual" },
                { time: "09:30", activity: "Brunch saludable ğŸ¥‘", duration: "1 hr", category: "nutricion" },
                { time: "10:30", activity: "Spa personal: mascarillas, tratamientos âœ¨", duration: "1.5 hrs", category: "fisico" },
                { time: "12:00", activity: "Revisar metas + Ajustar plan ğŸ¯", duration: "1 hr", category: "personal" },
                { time: "13:00", activity: "Almuerzo liviano", duration: "1 hr", category: "nutricion" },
                { time: "14:00", activity: "Siesta / Descanso profundo ğŸ˜´", duration: "1 hr", category: "descanso" },
                { time: "15:00", activity: "Yoga + Stretching profundo ğŸ§˜", duration: "1 hr", category: "fisico" },
                { time: "16:00", activity: "InglÃ©s: pelÃ­culas/series ğŸ¬", duration: "1 hr", category: "personal" },
                { time: "17:00", activity: "Preparar outfits de la semana ğŸ‘—", duration: "1 hr", category: "personal" },
                { time: "18:00", activity: "RRSS: Responder mensajes + Stories ğŸ“±", duration: "1 hr", category: "digital" },
                { time: "19:00", activity: "Tiempo familiar / Social ğŸ’•", duration: "1 hr", category: "personal" },
                { time: "20:00", activity: "Cena liviana", duration: "1 hr", category: "nutricion" },
                { time: "21:00", activity: "Rutina nocturna ğŸŒ™", duration: "30 min", category: "fisico" },
                { time: "21:30", activity: "Lectura + Gratitud + Intenciones âœ¨", duration: "30 min", category: "espiritual" },
                { time: "22:00", activity: "DORMIR ğŸ˜´", duration: "9 hrs", category: "descanso" }
            ];
        }

        function getDateKey(date = currentDate) {
            return date.toISOString().split('T')[0];
        }

        function getWeekNumber(date = currentDate) {
            return Math.min(totalWeeks, Math.max(1, Math.floor((date - startDate) / (7 * 24 * 60 * 60 * 1000)) + 1));
        }

        function getDayNumber(date = currentDate) {
            return Math.floor((date - startDate) / (24 * 60 * 60 * 1000)) + 1;
        }

        function getDailyProgress(date = currentDate) {
            const dateKey = getDateKey(date);
            const schedule = getSchedule(date.getDay(), dateKey);
            const totalActivities = schedule.length;
            if (totalActivities === 0) return 0;
            let completed = 0;

            for (let i = 0; i < totalActivities; i++) {
                if (completedActivities[`${dateKey}-${i}`]) {
                    completed++;
                }
            }

            return Math.round((completed / totalActivities) * 100);
        }

        function getWeeklyProgress() {
            const weekNum = getWeekNumber();
            const weekStart = new Date(startDate);
            weekStart.setDate(weekStart.getDate() + (weekNum - 1) * 7);

            let totalActivities = 0;
            let completedCount = 0;

            for (let i = 0; i < 7; i++) {
                const dayDate = new Date(weekStart);
                dayDate.setDate(dayDate.getDate() + i);

                if (dayDate > endDate) break;

                const dateKey = getDateKey(dayDate);
                const schedule = getSchedule(dayDate.getDay(), dateKey);
                totalActivities += schedule.length;

                for (let j = 0; j < schedule.length; j++) {
                    if (completedActivities[`${dateKey}-${j}`]) {
                        completedCount++;
                    }
                }
            }

            return totalActivities > 0 ? Math.round((completedCount / totalActivities) * 100) : 0;
        }

        function getTotalProgress() {
            let totalActivities = 0;
            let completedCount = 0;

            const tempDate = new Date(startDate);
            while (tempDate <= endDate) {
                const dateKey = getDateKey(tempDate);
                const schedule = getSchedule(tempDate.getDay(), dateKey);
                totalActivities += schedule.length;

                for (let j = 0; j < schedule.length; j++) {
                    if (completedActivities[`${dateKey}-${j}`]) {
                        completedCount++;
                    }
                }

                tempDate.setDate(tempDate.getDate() + 1);
            }

            return totalActivities > 0 ? Math.round((completedCount / totalActivities) * 100) : 0;
        }

        function navigateDay(direction) {
            const newDate = new Date(currentDate);
            newDate.setDate(newDate.getDate() + direction);
            if (newDate >= startDate && newDate <= endDate) {
                currentDate = newDate;
                render();
            }
        }

        function setTab(tab) {
            activeTab = tab;
            render();
        }

        function toggleHabit(habitId) {
            const key = `${getDateKey()}-${habitId}`;
            checkedHabits[key] = !checkedHabits[key];
            setStorage('habits', JSON.stringify(checkedHabits));
            render();
        }

        function toggleActivity(index) {
            const key = `${getDateKey()}-${index}`;
            completedActivities[key] = !completedActivities[key];
            setStorage('activities', JSON.stringify(completedActivities));
            render();
        }

        // ========== ACTIVITY MODALS ==========
        function openEditModal(index) {
            event.stopPropagation();
            editingIndex = index;
            const dateKey = getDateKey();
            const schedule = getSchedule(currentDate.getDay(), dateKey);
            const item = schedule[index];

            document.getElementById('editTime').value = item.time;
            document.getElementById('editActivity').value = item.activity;
            document.getElementById('editDuration').value = item.duration;
            document.getElementById('editCategory').value = item.category;

            document.getElementById('editModal').classList.remove('hidden');
        }

        function closeEditModal() {
            document.getElementById('editModal').classList.add('hidden');
            editingIndex = null;
        }

        function saveEdit() {
            const dateKey = getDateKey();
            let schedule = getSchedule(currentDate.getDay(), dateKey);
            const originalActivity = schedule[editingIndex].activity;

            const newItem = {
                time: document.getElementById('editTime').value,
                activity: document.getElementById('editActivity').value,
                duration: document.getElementById('editDuration').value,
                category: document.getElementById('editCategory').value
            };

            // Guardar este dÃ­a primero
            if (!customSchedules[dateKey]) {
                schedule = JSON.parse(JSON.stringify(schedule));
            }
            schedule[editingIndex] = newItem;
            schedule.sort((a, b) => a.time.localeCompare(b.time));
            saveCustomSchedule(dateKey, schedule);

            closeEditModal();

            // Preguntar si reemplazar en todos los dÃ­as
            showReplaceAllModal('schedule',
                `Â¿Aplicar este cambio a "${originalActivity}" en todos los dÃ­as?`,
                (replaceAll) => {
                    if (replaceAll) {
                        replaceActivityInAllDays(originalActivity, newItem);
                    }
                }
            );
        }

        function replaceActivityInAllDays(originalName, newItem) {
            // Reemplazar en horarios por defecto customizados
            Object.keys(customSchedules).forEach(key => {
                const schedule = customSchedules[key];
                schedule.forEach((item, idx) => {
                    if (item.activity === originalName) {
                        schedule[idx] = { ...newItem };
                    }
                });
                setStorage(`schedule-${key}`, JSON.stringify(schedule));
            });
            render();
        }

        function openDeleteModal(index, type = 'activity') {
            event.stopPropagation();
            deletingIndex = index;
            deleteType = type;

            let itemName = '';
            if (type === 'activity') {
                const dateKey = getDateKey();
                const schedule = getSchedule(currentDate.getDay(), dateKey);
                itemName = schedule[index].activity;
            } else if (type === 'habit') {
                itemName = getHabits()[index].name;
            } else if (type === 'gym') {
                const dayIndex = currentDate.getDay();
                itemName = getGymFocus(dayIndex).exercises[index];
            } else if (type === 'meal') {
                itemName = getMeals()[index].name;
            } else if (type === 'goal') {
                itemName = `Semana ${getWeeklyGoals()[index].week}`;
            }

            document.getElementById('deleteActivityName').textContent = `"${itemName}"`;
            document.getElementById('deleteModal').classList.remove('hidden');
        }

        function closeDeleteModal() {
            document.getElementById('deleteModal').classList.add('hidden');
            deletingIndex = null;
        }

        function confirmDelete() {
            if (deleteType === 'activity') {
                deleteActivity();
            } else if (deleteType === 'habit') {
                deleteHabit();
            } else if (deleteType === 'gym') {
                deleteGymExercise();
            } else if (deleteType === 'meal') {
                deleteMeal();
            } else if (deleteType === 'goal') {
                deleteGoal();
            }
            closeDeleteModal();
            render();
        }

        function deleteActivity() {
            const dateKey = getDateKey();
            let schedule = getSchedule(currentDate.getDay(), dateKey);

            if (!customSchedules[dateKey]) {
                schedule = JSON.parse(JSON.stringify(schedule));
            }

            schedule.splice(deletingIndex, 1);

            const newCompleted = {};
            Object.keys(completedActivities).forEach(key => {
                if (key.startsWith(dateKey)) {
                    const idx = parseInt(key.split('-').pop());
                    if (idx < deletingIndex) {
                        newCompleted[key] = completedActivities[key];
                    } else if (idx > deletingIndex) {
                        newCompleted[`${dateKey}-${idx - 1}`] = completedActivities[key];
                    }
                } else {
                    newCompleted[key] = completedActivities[key];
                }
            });
            completedActivities = newCompleted;
            setStorage('activities', JSON.stringify(completedActivities));

            saveCustomSchedule(dateKey, schedule);
        }

        function openAddModal() {
            document.getElementById('addTime').value = '';
            document.getElementById('addActivity').value = '';
            document.getElementById('addDuration').value = '';
            document.getElementById('addCategory').value = 'personal';
            document.getElementById('addModal').classList.remove('hidden');
        }

        function closeAddModal() {
            document.getElementById('addModal').classList.add('hidden');
        }

        function saveNewActivity() {
            const time = document.getElementById('addTime').value;
            const activity = document.getElementById('addActivity').value;
            const duration = document.getElementById('addDuration').value;
            const category = document.getElementById('addCategory').value;

            if (!time || !activity) {
                alert('Por favor completa la hora y la actividad');
                return;
            }

            const dateKey = getDateKey();
            let schedule = getSchedule(currentDate.getDay(), dateKey);

            if (!customSchedules[dateKey]) {
                schedule = JSON.parse(JSON.stringify(schedule));
            }

            schedule.push({ time, activity, duration, category });
            schedule.sort((a, b) => a.time.localeCompare(b.time));

            saveCustomSchedule(dateKey, schedule);
            closeAddModal();
            render();
        }

        function resetDay() {
            if (confirm('Â¿Restaurar el plan original de este dÃ­a? Se perderÃ¡n los cambios.')) {
                const dateKey = getDateKey();
                delete customSchedules[dateKey];
                setStorage('custom-schedules', JSON.stringify(customSchedules));

                Object.keys(completedActivities).forEach(key => {
                    if (key.startsWith(dateKey)) {
                        delete completedActivities[key];
                    }
                });
                setStorage('activities', JSON.stringify(completedActivities));

                render();
            }
        }

        // ========== HABIT MODALS ==========
        function openEditHabitModal(index) {
            event.stopPropagation();
            editingIndex = index;
            const habit = getHabits()[index];

            document.getElementById('editHabitIcon').value = habit.icon;
            document.getElementById('editHabitName').value = habit.name;

            document.getElementById('editHabitModal').classList.remove('hidden');
        }

        function closeEditHabitModal() {
            document.getElementById('editHabitModal').classList.add('hidden');
            editingIndex = null;
        }

        function saveHabitEdit() {
            const newIcon = document.getElementById('editHabitIcon').value;
            const newName = document.getElementById('editHabitName').value;

            closeEditHabitModal();

            showReplaceAllModal('habit',
                `Este cambio aplicarÃ¡ a "${newName}" en todos los dÃ­as. Â¿Continuar?`,
                (confirmed) => {
                    if (confirmed) {
                        let habits = customHabits || JSON.parse(JSON.stringify(defaultHabits));
                        habits[editingIndex] = {
                            id: habits[editingIndex].id,
                            icon: newIcon,
                            name: newName
                        };
                        customHabits = habits;
                        setStorage('custom-habits', JSON.stringify(customHabits));
                    }
                }
            );
        }

        function deleteHabit() {
            let habits = customHabits || JSON.parse(JSON.stringify(defaultHabits));
            habits.splice(deletingIndex, 1);
            customHabits = habits;
            setStorage('custom-habits', JSON.stringify(customHabits));
        }

        function openAddHabitModal() {
            document.getElementById('addHabitIcon').value = 'â­';
            document.getElementById('addHabitName').value = '';
            document.getElementById('addHabitModal').classList.remove('hidden');
        }

        function closeAddHabitModal() {
            document.getElementById('addHabitModal').classList.add('hidden');
        }

        function saveNewHabit() {
            const icon = document.getElementById('addHabitIcon').value;
            const name = document.getElementById('addHabitName').value;

            if (!name) {
                alert('Por favor ingresa el nombre del hÃ¡bito');
                return;
            }

            let habits = customHabits || JSON.parse(JSON.stringify(defaultHabits));
            const newId = Math.max(...habits.map(h => h.id)) + 1;
            habits.push({ id: newId, icon, name });

            customHabits = habits;
            setStorage('custom-habits', JSON.stringify(customHabits));
            closeAddHabitModal();
            render();
        }

        function resetHabits() {
            if (confirm('Â¿Restaurar los hÃ¡bitos originales?')) {
                customHabits = null;
                removeStorage('custom-habits');
                render();
            }
        }

        // ========== GYM MODALS ==========
        function openEditGymModal(index) {
            event.stopPropagation();
            editingIndex = index;
            const dayIndex = currentDate.getDay();
            const gym = getGymFocus(dayIndex);

            document.getElementById('editGymExercise').value = gym.exercises[index];

            document.getElementById('editGymModal').classList.remove('hidden');
        }

        function closeEditGymModal() {
            document.getElementById('editGymModal').classList.add('hidden');
            editingIndex = null;
        }

        function saveGymEdit() {
            const dayIndex = currentDate.getDay();
            let gym = customGym[dayIndex] || JSON.parse(JSON.stringify(defaultGymFocus[dayIndex]));
            const originalExercise = gym.exercises[editingIndex];
            const newExercise = document.getElementById('editGymExercise').value;

            // Guardar este dÃ­a primero
            gym.exercises[editingIndex] = newExercise;
            customGym[dayIndex] = gym;
            setStorage('custom-gym', JSON.stringify(customGym));

            closeEditGymModal();

            showReplaceAllModal('gym',
                `Â¿Reemplazar "${originalExercise}" en todos los dÃ­as de la semana?`,
                (replaceAll) => {
                    if (replaceAll) {
                        // Reemplazar en todos los dÃ­as
                        for (let d = 0; d < 7; d++) {
                            if (d !== dayIndex && customGym[d]) {
                                customGym[d].exercises = customGym[d].exercises.map(ex =>
                                    ex === originalExercise ? newExercise : ex
                                );
                            }
                        }
                        setStorage('custom-gym', JSON.stringify(customGym));
                    }
                }
            );
        }

        function deleteGymExercise() {
            const dayIndex = currentDate.getDay();
            let gym = customGym[dayIndex] || JSON.parse(JSON.stringify(defaultGymFocus[dayIndex]));
            gym.exercises.splice(deletingIndex, 1);
            customGym[dayIndex] = gym;
            setStorage('custom-gym', JSON.stringify(customGym));
        }

        function openAddGymModal() {
            document.getElementById('addGymExercise').value = '';
            document.getElementById('addGymModal').classList.remove('hidden');
        }

        function closeAddGymModal() {
            document.getElementById('addGymModal').classList.add('hidden');
        }

        function saveNewGymExercise() {
            const exercise = document.getElementById('addGymExercise').value;

            if (!exercise) {
                alert('Por favor ingresa el ejercicio');
                return;
            }

            const dayIndex = currentDate.getDay();
            let gym = customGym[dayIndex] || JSON.parse(JSON.stringify(defaultGymFocus[dayIndex]));
            gym.exercises.push(exercise);

            customGym[dayIndex] = gym;
            setStorage('custom-gym', JSON.stringify(customGym));
            closeAddGymModal();
            render();
        }

        function resetGym() {
            if (confirm('Â¿Restaurar la rutina original de este dÃ­a?')) {
                const dayIndex = currentDate.getDay();
                delete customGym[dayIndex];
                setStorage('custom-gym', JSON.stringify(customGym));
                render();
            }
        }

        // ========== MEAL MODALS ==========
        function openEditMealModal(index) {
            event.stopPropagation();
            editingIndex = index;
            const meal = getMeals()[index];

            document.getElementById('editMealTime').value = meal.time;
            document.getElementById('editMealName').value = meal.name;
            document.getElementById('editMealEmoji').value = meal.emoji;
            document.getElementById('editMealOptions').value = meal.options.join('\n');
            document.getElementById('editMealMacros').value = meal.macros;

            document.getElementById('editMealModal').classList.remove('hidden');
        }

        function closeEditMealModal() {
            document.getElementById('editMealModal').classList.add('hidden');
            editingIndex = null;
        }

        function saveMealEdit() {
            const newMeal = {
                time: document.getElementById('editMealTime').value,
                name: document.getElementById('editMealName').value,
                emoji: document.getElementById('editMealEmoji').value,
                options: document.getElementById('editMealOptions').value.split('\n').filter(o => o.trim()),
                macros: document.getElementById('editMealMacros').value
            };

            closeEditMealModal();

            showReplaceAllModal('meal',
                `Este cambio aplicarÃ¡ a "${newMeal.name}" en todos los dÃ­as. Â¿Continuar?`,
                (confirmed) => {
                    if (confirmed) {
                        let meals = customMeals || JSON.parse(JSON.stringify(defaultMeals));
                        meals[editingIndex] = newMeal;
                        meals.sort((a, b) => a.time.localeCompare(b.time));
                        customMeals = meals;
                        setStorage('custom-meals', JSON.stringify(customMeals));
                    }
                }
            );
        }

        function deleteMeal() {
            let meals = customMeals || JSON.parse(JSON.stringify(defaultMeals));
            meals.splice(deletingIndex, 1);
            customMeals = meals;
            setStorage('custom-meals', JSON.stringify(customMeals));
        }

        function openAddMealModal() {
            document.getElementById('addMealTime').value = '';
            document.getElementById('addMealName').value = '';
            document.getElementById('addMealEmoji').value = 'ğŸ½ï¸';
            document.getElementById('addMealOptions').value = '';
            document.getElementById('addMealMacros').value = '';
            document.getElementById('addMealModal').classList.remove('hidden');
        }

        function closeAddMealModal() {
            document.getElementById('addMealModal').classList.add('hidden');
        }

        function saveNewMeal() {
            const time = document.getElementById('addMealTime').value;
            const name = document.getElementById('addMealName').value;

            if (!time || !name) {
                alert('Por favor completa la hora y el nombre');
                return;
            }

            let meals = customMeals || JSON.parse(JSON.stringify(defaultMeals));
            meals.push({
                time,
                name,
                emoji: document.getElementById('addMealEmoji').value || 'ğŸ½ï¸',
                options: document.getElementById('addMealOptions').value.split('\n').filter(o => o.trim()),
                macros: document.getElementById('addMealMacros').value
            });

            meals.sort((a, b) => a.time.localeCompare(b.time));

            customMeals = meals;
            setStorage('custom-meals', JSON.stringify(customMeals));
            closeAddMealModal();
            render();
        }

        function resetMeals() {
            if (confirm('Â¿Restaurar el plan de comidas original?')) {
                customMeals = null;
                removeStorage('custom-meals');
                render();
            }
        }

        // ========== GOAL MODALS ==========
        function openEditGoalModal(index) {
            event.stopPropagation();
            editingIndex = index;
            const goal = getWeeklyGoals()[index];

            document.getElementById('editGoalWeek').value = goal.week;
            document.getElementById('editGoalDates').value = goal.dates;
            document.getElementById('editGoalFisica').value = goal.fisica;
            document.getElementById('editGoalPersonal').value = goal.personal;
            document.getElementById('editGoalDigital').value = goal.digital;
            document.getElementById('editGoalEspiritual').value = goal.espiritual;

            document.getElementById('editGoalModal').classList.remove('hidden');
        }

        function closeEditGoalModal() {
            document.getElementById('editGoalModal').classList.add('hidden');
            editingIndex = null;
        }

        function saveGoalEdit() {
            let goals = customGoals || JSON.parse(JSON.stringify(defaultWeeklyGoals));

            goals[editingIndex] = {
                week: parseInt(document.getElementById('editGoalWeek').value),
                dates: document.getElementById('editGoalDates').value,
                fisica: document.getElementById('editGoalFisica').value,
                personal: document.getElementById('editGoalPersonal').value,
                digital: document.getElementById('editGoalDigital').value,
                espiritual: document.getElementById('editGoalEspiritual').value
            };

            goals.sort((a, b) => a.week - b.week);

            customGoals = goals;
            setStorage('custom-goals', JSON.stringify(customGoals));
            closeEditGoalModal();
            render();
        }

        function deleteGoal() {
            let goals = customGoals || JSON.parse(JSON.stringify(defaultWeeklyGoals));
            goals.splice(deletingIndex, 1);
            customGoals = goals;
            setStorage('custom-goals', JSON.stringify(customGoals));
        }

        function resetGoals() {
            if (confirm('Â¿Restaurar las metas originales?')) {
                customGoals = null;
                removeStorage('custom-goals');
                render();
            }
        }

        function renderProgressCircle(percent, size, strokeWidth, color, label) {
            const radius = (size - strokeWidth) / 2;
            const circumference = radius * 2 * Math.PI;
            const offset = circumference - (percent / 100) * circumference;

            return `
                <div class="flex flex-col items-center">
                    <div class="relative" style="width: ${size}px; height: ${size}px;">
                        <svg class="transform -rotate-90" width="${size}" height="${size}">
                            <circle cx="${size/2}" cy="${size/2}" r="${radius}" stroke="#e5e7eb" stroke-width="${strokeWidth}" fill="none"/>
                            <circle cx="${size/2}" cy="${size/2}" r="${radius}" stroke="url(#gradient-${label})" stroke-width="${strokeWidth}" fill="none" stroke-linecap="round" stroke-dasharray="${circumference}" stroke-dashoffset="${offset}" class="progress-ring"/>
                            <defs>
                                <linearGradient id="gradient-${label}" x1="0%" y1="0%" x2="100%" y2="0%">
                                    <stop offset="0%" style="stop-color:${color === 'rose' ? '#ec4899' : color === 'purple' ? '#8b5cf6' : '#06b6d4'}"/>
                                    <stop offset="100%" style="stop-color:${color === 'rose' ? '#f43f5e' : color === 'purple' ? '#a855f7' : '#0891b2'}"/>
                                </linearGradient>
                            </defs>
                        </svg>
                        <div class="absolute inset-0 flex items-center justify-center">
                            <span class="text-lg font-bold text-gray-800">${percent}%</span>
                        </div>
                    </div>
                    <span class="text-xs text-gray-500 mt-1 font-medium">${label}</span>
                </div>
            `;
        }

        function render() {
            const dayIndex = currentDate.getDay();
            const weekNum = getWeekNumber();
            const dayNum = getDayNumber();
            const dateKey = getDateKey();
            const dailyProgress = getDailyProgress();
            const weeklyProgress = getWeeklyProgress();
            const totalProgress = getTotalProgress();
            const schedule = getSchedule(dayIndex, dateKey);
            const gym = getGymFocus(dayIndex);
            const isCustomized = !!customSchedules[dateKey];

            const app = document.getElementById('app');
            app.innerHTML = `
                <!-- Header -->
                <header class="bg-white/90 backdrop-blur-sm shadow-sm sticky top-0 z-50">
                    <div class="max-w-4xl mx-auto px-3 py-2">
                        <div class="flex items-center gap-3">
                            <div class="relative flex-shrink-0 cursor-pointer group" onclick="openPhotoModal()" title="Cambiar foto de perfil">
                                <div class="w-12 h-12 rounded-full bg-gradient-to-r from-pink-500 to-purple-500 flex items-center justify-center text-white text-lg font-bold border-2 border-purple-200 photo-glow overflow-hidden group-hover:opacity-80 transition">
                                    ${getUserPhoto() ? `<img src="${getUserPhoto()}" class="w-full h-full object-cover">` : currentUser.name.charAt(0).toUpperCase()}
                                </div>
                                <span class="absolute -bottom-0.5 -right-0.5 text-sm group-hover:scale-110 transition">ğŸ“·</span>
                            </div>
                            <div class="flex-1 min-w-0">
                                <h1 class="text-base font-bold gradient-text">ğŸ‘‹ ${currentUser.name}</h1>
                                <p class="text-xs text-gray-500">${getGoalText(currentUser.goal)}</p>
                            </div>
                            <div class="flex items-center gap-2">
                                <div class="flex flex-col items-end gap-1 text-xs flex-shrink-0">
                                    <span class="px-2 py-0.5 bg-purple-100 text-purple-700 rounded-full font-medium">S${weekNum}/${totalWeeks}</span>
                                    <span class="px-2 py-0.5 bg-rose-100 text-rose-700 rounded-full font-medium">D${dayNum}/${userDuration}</span>
                                </div>
                                <button onclick="logout()" class="p-2 text-gray-400 hover:text-red-500 transition" title="Cerrar sesiÃ³n">
                                    ğŸšª
                                </button>
                            </div>
                        </div>
                    </div>
                </header>

                <!-- Progress Dashboard -->
                <div class="bg-white/80 backdrop-blur-sm border-b">
                    <div class="max-w-4xl mx-auto px-4 py-5">
                        <div class="flex justify-around items-center">
                            ${renderProgressCircle(dailyProgress, 80, 8, 'rose', 'HOY')}
                            ${renderProgressCircle(weeklyProgress, 80, 8, 'purple', 'SEMANA')}
                            ${renderProgressCircle(totalProgress, 80, 8, 'cyan', 'TOTAL')}
                        </div>
                        <div class="mt-4 text-center">
                            <p class="text-sm text-gray-500">
                                ${totalProgress === 100 ? 'ğŸ† Â¡PROGRAMA COMPLETADO! Â¡Eres una campeona!' :
                                  totalProgress >= 75 ? 'ğŸ”¥ Â¡Vas increÃ­ble! La corona te espera' :
                                  totalProgress >= 50 ? 'ğŸ’ª Â¡MÃ¡s de la mitad! Sigue asÃ­' :
                                  totalProgress >= 25 ? 'âœ¨ Â¡Buen progreso! No te detengas' :
                                  'ğŸŒŸ Â¡Cada dÃ­a cuenta! TÃº puedes'}
                            </p>
                        </div>
                    </div>
                </div>

                <!-- Date Navigation -->
                <div class="bg-white/60 backdrop-blur-sm border-b">
                    <div class="max-w-4xl mx-auto px-4 py-4">
                        <div class="flex items-center justify-between">
                            <button onclick="navigateDay(-1)" class="p-3 hover:bg-white rounded-full transition text-2xl ${currentDate <= startDate ? 'opacity-30' : ''}">â—€ï¸</button>
                            <div class="text-center">
                                <p class="text-2xl font-bold text-gray-800">${daysSpanish[dayIndex]}</p>
                                <p class="text-gray-500">${currentDate.getDate()} de ${monthsSpanish[currentDate.getMonth()]} 2026</p>
                                ${isCustomized ? '<span class="text-xs text-purple-500">âœï¸ Personalizado</span>' : ''}
                            </div>
                            <button onclick="navigateDay(1)" class="p-3 hover:bg-white rounded-full transition text-2xl ${currentDate >= endDate ? 'opacity-30' : ''}">â–¶ï¸</button>
                        </div>
                    </div>
                </div>

                <!-- Tabs -->
                <div class="bg-white/40 border-b sticky top-[88px] z-40">
                    <div class="max-w-4xl mx-auto px-4">
                        <div class="flex gap-2 overflow-x-auto py-3 no-scrollbar">
                            ${['agenda', 'habits', 'gym', 'meals', 'goals'].map(tab => `
                                <button onclick="setTab('${tab}')" class="flex items-center gap-2 px-4 py-2 rounded-full text-sm font-medium transition whitespace-nowrap ${activeTab === tab ? 'tab-active shadow-md' : 'bg-white/80 text-gray-600 hover:bg-white'}">
                                    ${tab === 'agenda' ? 'ğŸ“… Agenda' : tab === 'habits' ? 'âœ… HÃ¡bitos' : tab === 'gym' ? 'ğŸ’ª Gym' : tab === 'meals' ? 'ğŸ¥— Comidas' : 'ğŸ¯ Metas'}
                                </button>
                            `).join('')}
                        </div>
                    </div>
                </div>

                <!-- Content -->
                <main class="max-w-4xl mx-auto px-4 py-6">
                    ${activeTab === 'agenda' ? renderAgenda(schedule, gym, dateKey, dailyProgress, isCustomized) : ''}
                    ${activeTab === 'habits' ? renderHabits(dateKey) : ''}
                    ${activeTab === 'gym' ? renderGym(gym, dayIndex, weekNum) : ''}
                    ${activeTab === 'meals' ? renderMeals() : ''}
                    ${activeTab === 'goals' ? renderGoals(weekNum) : ''}
                </main>

                <!-- Footer -->
                <footer class="bg-white/80 backdrop-blur-sm border-t mt-8">
                    <div class="max-w-4xl mx-auto px-4 py-6 text-center">
                        <p class="text-lg font-medium text-gray-700">"El Ã©xito es la suma de pequeÃ±os esfuerzos repetidos dÃ­a tras dÃ­a"</p>
                        <p class="text-purple-500 mt-2 text-xl">âœ¨ Â¡TÃº puedes, ${currentUser.name.split(' ')[0]}! âœ¨</p>
                    </div>
                </footer>
            `;
        }

        function renderAgenda(schedule, gym, dateKey, dailyProgress, isCustomized) {
            const completedCount = schedule.filter((_, idx) => completedActivities[`${dateKey}-${idx}`]).length;

            return `
                <div class="space-y-3">
                    <div class="bg-gradient-to-r from-rose-500 to-purple-600 rounded-2xl p-5 text-white shadow-lg mb-4">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center gap-4">
                                <span class="text-5xl">${gym.icon}</span>
                                <div>
                                    <p class="font-bold text-xl">${gym.name}</p>
                                    <p class="text-white/80 text-sm">${schedule.length} actividades hoy</p>
                                </div>
                            </div>
                            <div class="text-right">
                                <p class="text-4xl font-bold">${dailyProgress}%</p>
                                <p class="text-white/80 text-sm">${completedCount}/${schedule.length} completadas</p>
                            </div>
                        </div>
                        <div class="mt-4 h-2 bg-white/20 rounded-full overflow-hidden">
                            <div class="h-full bg-white rounded-full progress-bar" style="width: ${dailyProgress}%"></div>
                        </div>
                    </div>

                    <div class="flex gap-2 mb-4">
                        <button onclick="openAddModal()" class="flex-1 flex items-center justify-center gap-2 px-4 py-3 bg-white rounded-xl shadow-sm hover:shadow-md transition font-medium text-purple-600 border-2 border-purple-100">
                            <span class="text-xl">â•</span> Agregar Actividad
                        </button>
                        ${isCustomized ? `
                            <button onclick="resetDay()" class="flex items-center justify-center gap-2 px-4 py-3 bg-white rounded-xl shadow-sm hover:shadow-md transition font-medium text-gray-500 border-2 border-gray-100">
                                <span class="text-xl">ğŸ”„</span> Restaurar
                            </button>
                        ` : ''}
                    </div>

                    ${schedule.map((item, idx) => {
                        const colors = categoryColors[item.category] || categoryColors.personal;
                        const isCompleted = completedActivities[`${dateKey}-${idx}`];
                        return `
                            <div class="${colors.bg} ${colors.border} border rounded-xl p-4 transition-all card-hover ${isCompleted ? 'checked-item' : ''}">
                                <div class="flex items-start gap-4">
                                    <div onclick="toggleActivity(${idx})" class="w-12 h-12 rounded-full ${isCompleted ? 'bg-green-500' : colors.badge} flex items-center justify-center flex-shrink-0 text-xl transition-all cursor-pointer hover:scale-110 ${isCompleted ? 'text-white' : ''}">
                                        ${isCompleted ? 'âœ“' : 'â—‹'}
                                    </div>
                                    <div class="flex-1 min-w-0" onclick="toggleActivity(${idx})" style="cursor: pointer;">
                                        <div class="flex items-center gap-2 mb-1 flex-wrap">
                                            <span class="font-mono text-sm text-gray-500">${item.time}</span>
                                            <span class="text-xs px-2 py-0.5 rounded-full ${colors.badge} ${colors.text}">${item.duration}</span>
                                        </div>
                                        <p class="font-medium ${isCompleted ? 'line-through text-gray-400' : 'text-gray-800'}">${item.activity}</p>
                                    </div>
                                    <div class="flex gap-1 flex-shrink-0">
                                        <button onclick="openEditModal(${idx})" class="btn-icon w-10 h-10 rounded-full bg-blue-100 text-blue-600 flex items-center justify-center hover:bg-blue-200" title="Editar">
                                            âœï¸
                                        </button>
                                        <button onclick="openDeleteModal(${idx}, 'activity')" class="btn-icon w-10 h-10 rounded-full bg-red-100 text-red-600 flex items-center justify-center hover:bg-red-200" title="Eliminar">
                                            ğŸ—‘ï¸
                                        </button>
                                    </div>
                                </div>
                            </div>
                        `;
                    }).join('')}

                    ${schedule.length === 0 ? `
                        <div class="text-center py-12 text-gray-400">
                            <span class="text-5xl block mb-4">ğŸ“</span>
                            <p>No hay actividades para este dÃ­a</p>
                            <p class="text-sm">Presiona "Agregar Actividad" para comenzar</p>
                        </div>
                    ` : ''}
                </div>
            `;
        }

        function renderHabits(dateKey) {
            const habits = getHabits();
            const completedCount = habits.filter(h => checkedHabits[`${dateKey}-${h.id}`]).length;
            const progress = Math.round((completedCount / habits.length) * 100);
            const isCustomized = customHabits !== null;

            return `
                <div class="space-y-4">
                    <div class="bg-white rounded-2xl p-5 shadow-sm">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="font-bold text-lg text-gray-800">HÃ¡bitos del dÃ­a</h3>
                            <span class="text-2xl font-bold text-purple-600">${completedCount}/${habits.length}</span>
                        </div>
                        <div class="h-4 bg-gray-100 rounded-full overflow-hidden">
                            <div class="h-full bg-gradient-to-r from-rose-400 to-purple-500 progress-bar" style="width: ${progress}%"></div>
                        </div>
                        <p class="text-center mt-3 text-sm text-gray-500">
                            ${progress === 100 ? 'ğŸ‰ Â¡Todos los hÃ¡bitos completados!' : progress >= 80 ? 'ğŸ’ª Â¡Casi perfecto!' : progress >= 50 ? 'âœ¨ Â¡Vas muy bien!' : 'ğŸŒŸ Â¡Sigue adelante!'}
                        </p>
                    </div>

                    <div class="flex gap-2 mb-4">
                        <button onclick="openAddHabitModal()" class="flex-1 flex items-center justify-center gap-2 px-4 py-3 bg-white rounded-xl shadow-sm hover:shadow-md transition font-medium text-purple-600 border-2 border-purple-100">
                            <span class="text-xl">â•</span> Agregar HÃ¡bito
                        </button>
                        ${isCustomized ? `
                            <button onclick="resetHabits()" class="flex items-center justify-center gap-2 px-4 py-3 bg-white rounded-xl shadow-sm hover:shadow-md transition font-medium text-gray-500 border-2 border-gray-100">
                                <span class="text-xl">ğŸ”„</span> Restaurar
                            </button>
                        ` : ''}
                    </div>

                    <div class="grid gap-3">
                        ${habits.map((habit, idx) => {
                            const isChecked = checkedHabits[`${dateKey}-${habit.id}`];
                            return `
                                <div class="flex items-center gap-2 p-4 rounded-xl border-2 transition-all ${isChecked ? 'habit-checked' : 'bg-white border-gray-100 hover:border-gray-200'}">
                                    <button onclick="toggleHabit(${habit.id})" class="flex items-center gap-4 flex-1 text-left">
                                        <div class="w-8 h-8 rounded-full border-2 flex items-center justify-center transition-all flex-shrink-0 ${isChecked ? 'bg-purple-500 border-purple-500 text-white' : 'border-gray-300'}">
                                            ${isChecked ? 'âœ“' : ''}
                                        </div>
                                        <span class="text-2xl">${habit.icon}</span>
                                        <span class="font-medium ${isChecked ? 'text-purple-700' : 'text-gray-700'}">${habit.name}</span>
                                    </button>
                                    <div class="flex gap-1 flex-shrink-0">
                                        <button onclick="openEditHabitModal(${idx})" class="btn-icon w-9 h-9 rounded-full bg-blue-100 text-blue-600 flex items-center justify-center hover:bg-blue-200 text-sm" title="Editar">
                                            âœï¸
                                        </button>
                                        <button onclick="openDeleteModal(${idx}, 'habit')" class="btn-icon w-9 h-9 rounded-full bg-red-100 text-red-600 flex items-center justify-center hover:bg-red-200 text-sm" title="Eliminar">
                                            ğŸ—‘ï¸
                                        </button>
                                    </div>
                                </div>
                            `;
                        }).join('')}
                    </div>
                </div>
            `;
        }

        function renderGym(gym, dayIndex, weekNum) {
            const isCustomized = !!customGym[dayIndex];

            return `
                <div class="space-y-4">
                    <div class="bg-gradient-to-br from-rose-500 to-purple-600 rounded-2xl p-6 text-white shadow-lg">
                        <div class="flex items-center gap-4">
                            <span class="text-6xl">${gym.icon}</span>
                            <div>
                                <h3 class="text-2xl font-bold">${gym.name}</h3>
                                <p class="opacity-90">${daysSpanish[dayIndex]} - Semana ${weekNum}</p>
                            </div>
                        </div>
                    </div>

                    <div class="flex gap-2 mb-4">
                        <button onclick="openAddGymModal()" class="flex-1 flex items-center justify-center gap-2 px-4 py-3 bg-white rounded-xl shadow-sm hover:shadow-md transition font-medium text-purple-600 border-2 border-purple-100">
                            <span class="text-xl">â•</span> Agregar Ejercicio
                        </button>
                        ${isCustomized ? `
                            <button onclick="resetGym()" class="flex items-center justify-center gap-2 px-4 py-3 bg-white rounded-xl shadow-sm hover:shadow-md transition font-medium text-gray-500 border-2 border-gray-100">
                                <span class="text-xl">ğŸ”„</span> Restaurar
                            </button>
                        ` : ''}
                    </div>

                    <div class="bg-white rounded-2xl p-5 shadow-sm">
                        <h4 class="font-bold text-gray-800 mb-4 flex items-center gap-2">ğŸ’ª Ejercicios del dÃ­a</h4>
                        <div class="space-y-3">
                            ${gym.exercises.map((ex, idx) => `
                                <div class="flex items-center gap-3 p-3 bg-gray-50 rounded-xl">
                                    <span class="w-8 h-8 bg-purple-100 text-purple-600 rounded-full flex items-center justify-center font-bold text-sm flex-shrink-0">${idx + 1}</span>
                                    <span class="text-gray-700 flex-1">${ex}</span>
                                    <div class="flex gap-1 flex-shrink-0">
                                        <button onclick="openEditGymModal(${idx})" class="btn-icon w-8 h-8 rounded-full bg-blue-100 text-blue-600 flex items-center justify-center hover:bg-blue-200 text-sm" title="Editar">
                                            âœï¸
                                        </button>
                                        <button onclick="openDeleteModal(${idx}, 'gym')" class="btn-icon w-8 h-8 rounded-full bg-red-100 text-red-600 flex items-center justify-center hover:bg-red-200 text-sm" title="Eliminar">
                                            ğŸ—‘ï¸
                                        </button>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>

                    <div class="bg-amber-50 border border-amber-200 rounded-2xl p-5">
                        <h4 class="font-bold text-amber-800 mb-2">ğŸ’¡ Tips del dÃ­a</h4>
                        <ul class="text-amber-700 text-sm space-y-2">
                            <li>â€¢ Descanso entre series: 60-90 segundos</li>
                            <li>â€¢ MantÃ©n la conexiÃ³n mente-mÃºsculo</li>
                            <li>â€¢ HidrataciÃ³n constante durante el entreno</li>
                            <li>â€¢ Batido proteico dentro de 30 min post-gym</li>
                        </ul>
                    </div>

                    <div class="bg-rose-50 border border-rose-200 rounded-2xl p-5">
                        <h4 class="font-bold text-rose-800 mb-2">ğŸ¯ Objetivos fÃ­sicos</h4>
                        <ul class="text-rose-700 text-sm space-y-2">
                            <li>â€¢ Peso ideal: 58 kg</li>
                            <li>â€¢ GlÃºteos mÃ¡s grandes y definidos</li>
                            <li>â€¢ CuÃ¡driceps e isquios trabajados</li>
                            <li>â€¢ Abdominales marcados</li>
                        </ul>
                    </div>
                </div>
            `;
        }

        function renderMeals() {
            const meals = getMeals();
            const isCustomized = customMeals !== null;

            return `
                <div class="space-y-4">
                    <div class="flex gap-2 mb-4">
                        <button onclick="openAddMealModal()" class="flex-1 flex items-center justify-center gap-2 px-4 py-3 bg-white rounded-xl shadow-sm hover:shadow-md transition font-medium text-purple-600 border-2 border-purple-100">
                            <span class="text-xl">â•</span> Agregar Comida
                        </button>
                        ${isCustomized ? `
                            <button onclick="resetMeals()" class="flex items-center justify-center gap-2 px-4 py-3 bg-white rounded-xl shadow-sm hover:shadow-md transition font-medium text-gray-500 border-2 border-gray-100">
                                <span class="text-xl">ğŸ”„</span> Restaurar
                            </button>
                        ` : ''}
                    </div>

                    ${meals.map((meal, idx) => `
                        <div class="bg-white rounded-2xl p-5 shadow-sm card-hover">
                            <div class="flex items-center gap-3 mb-3">
                                <span class="text-4xl">${meal.emoji}</span>
                                <div class="flex-1">
                                    <h4 class="font-bold text-gray-800">${meal.name}</h4>
                                    <p class="text-sm text-gray-500">${meal.time}</p>
                                </div>
                                <span class="text-xs bg-green-100 text-green-700 px-3 py-1 rounded-full font-medium">${meal.macros}</span>
                                <div class="flex gap-1 flex-shrink-0">
                                    <button onclick="openEditMealModal(${idx})" class="btn-icon w-9 h-9 rounded-full bg-blue-100 text-blue-600 flex items-center justify-center hover:bg-blue-200 text-sm" title="Editar">
                                        âœï¸
                                    </button>
                                    <button onclick="openDeleteModal(${idx}, 'meal')" class="btn-icon w-9 h-9 rounded-full bg-red-100 text-red-600 flex items-center justify-center hover:bg-red-200 text-sm" title="Eliminar">
                                        ğŸ—‘ï¸
                                    </button>
                                </div>
                            </div>
                            <div class="space-y-2">
                                ${meal.options.map(opt => `
                                    <div class="flex items-center gap-2 text-gray-600">
                                        <span class="w-2 h-2 bg-purple-400 rounded-full flex-shrink-0"></span>
                                        <span>${opt}</span>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    `).join('')}

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="bg-red-50 border border-red-200 rounded-2xl p-5">
                            <h4 class="font-bold text-red-700 mb-3">âŒ Prohibidos</h4>
                            <ul class="text-red-600 space-y-2">
                                <li>â€¢ AzÃºcar refinada</li>
                                <li>â€¢ Bebidas azucaradas</li>
                                <li>â€¢ Frituras</li>
                                <li>â€¢ Harinas blancas</li>
                                <li>â€¢ Alcohol</li>
                            </ul>
                        </div>
                        <div class="bg-green-50 border border-green-200 rounded-2xl p-5">
                            <h4 class="font-bold text-green-700 mb-3">âœ… Suplementos</h4>
                            <ul class="text-green-600 space-y-2">
                                <li>â€¢ Creatina: 5g AM</li>
                                <li>â€¢ Omega 3: 1000mg</li>
                                <li>â€¢ Vitamina C: 1000mg</li>
                                <li>â€¢ ProteÃ­na: 25-30g</li>
                                <li>â€¢ Agua: 3L mÃ­nimo</li>
                            </ul>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderGoals(currentWeek) {
            const goals = getWeeklyGoals();
            const isCustomized = customGoals !== null;

            return `
                <div class="space-y-4">
                    <div class="flex gap-2 mb-4">
                        ${isCustomized ? `
                            <button onclick="resetGoals()" class="flex items-center justify-center gap-2 px-4 py-3 bg-white rounded-xl shadow-sm hover:shadow-md transition font-medium text-gray-500 border-2 border-gray-100">
                                <span class="text-xl">ğŸ”„</span> Restaurar Metas Originales
                            </button>
                        ` : ''}
                    </div>

                    ${goals.map((goal, idx) => `
                        <div class="rounded-2xl p-5 shadow-sm transition-all ${
                            goal.week === currentWeek
                                ? 'bg-gradient-to-r from-rose-500 to-purple-600 text-white ring-4 ring-purple-200 glow'
                                : goal.week < currentWeek
                                ? 'bg-gray-100 opacity-70'
                                : 'bg-white'
                        }">
                            <div class="flex items-center gap-3 mb-4">
                                <span class="w-12 h-12 rounded-full flex items-center justify-center font-bold text-lg ${
                                    goal.week === currentWeek ? 'bg-white/20' : goal.week < currentWeek ? 'bg-green-100 text-green-600' : 'bg-purple-100 text-purple-600'
                                }">
                                    ${goal.week < currentWeek ? 'âœ“' : goal.week}
                                </span>
                                <div class="flex-1">
                                    <h4 class="font-bold text-lg">Semana ${goal.week}</h4>
                                    <p class="text-sm ${goal.week === currentWeek ? 'text-white/80' : 'text-gray-500'}">${goal.dates}</p>
                                </div>
                                ${goal.week === currentWeek ? '<span class="px-3 py-1 bg-white/20 rounded-full text-sm animate-pulse">ğŸ“ EstÃ¡s aquÃ­</span>' : ''}
                                <button onclick="openEditGoalModal(${idx})" class="btn-icon w-10 h-10 rounded-full ${goal.week === currentWeek ? 'bg-white/20 text-white hover:bg-white/30' : 'bg-blue-100 text-blue-600 hover:bg-blue-200'} flex items-center justify-center" title="Editar">
                                    âœï¸
                                </button>
                            </div>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-3 text-sm">
                                <div class="p-3 rounded-xl ${goal.week === currentWeek ? 'bg-white/10' : 'bg-rose-50'}">
                                    <p class="font-medium mb-1 ${goal.week === currentWeek ? '' : 'text-rose-700'}">ğŸ’ª FÃ­sica</p>
                                    <p class="${goal.week === currentWeek ? 'text-white/90' : 'text-gray-600'}">${goal.fisica}</p>
                                </div>
                                <div class="p-3 rounded-xl ${goal.week === currentWeek ? 'bg-white/10' : 'bg-blue-50'}">
                                    <p class="font-medium mb-1 ${goal.week === currentWeek ? '' : 'text-blue-700'}">ğŸ“š Personal</p>
                                    <p class="${goal.week === currentWeek ? 'text-white/90' : 'text-gray-600'}">${goal.personal}</p>
                                </div>
                                <div class="p-3 rounded-xl ${goal.week === currentWeek ? 'bg-white/10' : 'bg-purple-50'}">
                                    <p class="font-medium mb-1 ${goal.week === currentWeek ? '' : 'text-purple-700'}">ğŸ“± Digital</p>
                                    <p class="${goal.week === currentWeek ? 'text-white/90' : 'text-gray-600'}">${goal.digital}</p>
                                </div>
                                <div class="p-3 rounded-xl ${goal.week === currentWeek ? 'bg-white/10' : 'bg-indigo-50'}">
                                    <p class="font-medium mb-1 ${goal.week === currentWeek ? '' : 'text-indigo-700'}">ğŸ§˜ Espiritual</p>
                                    <p class="${goal.week === currentWeek ? 'text-white/90' : 'text-gray-600'}">${goal.espiritual}</p>
                                </div>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        // Initial render
        render();
    </script>
</body>
</html>
